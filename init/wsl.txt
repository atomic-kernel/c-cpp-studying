wsl --install --no-distribution -n
wsl --update
wsl --version
wsl --set-default-version 2
wsl --import Ubuntu-24.10 f:\wsl\ubuntu_24_10 E:\xiazai\ubuntu-base-24.10-base-amd64.tar.gz --version 2
# wsl -d Ubuntu-24.10 -u root --cd /root -e env -i TERM=xterm-256color /bin/su -l root
# wsl -d Ubuntu-24.10 -u root --cd /root -e /bin/bash --login
wsl -d Ubuntu-24.10 -u root --cd /root -e /bin/login -p -f root

# 老版本sources.list
sed -i 's@^deb http://archive.ubuntu.com/ubuntu/@deb \[ arch=amd64,i386 \] http://mirrors.huaweicloud.com/ubuntu/@g' /etc/apt/sources.list
sed -i 's@^deb http://security.ubuntu.com/ubuntu/@deb \[ arch=amd64,i386 \] http://mirrors.huaweicloud.com/ubuntu/@g' /etc/apt/sources.list
sed -i 's@^# deb-src http://archive.ubuntu.com/ubuntu/@deb-src \[ arch=amd64,i386 \] http://mirrors.huaweicloud.com/ubuntu/@g' /etc/apt/sources.list
sed -i 's@^# deb-src http://security.ubuntu.com/ubuntu/@deb-src \[ arch=amd64,i386 \] http://mirrors.huaweicloud.com/ubuntu/@g' /etc/apt/sources.list

# 新版本sources.list
sed -i 's@^URIs: http://archive.ubuntu.com/ubuntu/@URIs: http://mirrors.huaweicloud.com/ubuntu/@g' /etc/apt/sources.list.d/ubuntu.sources
sed -i 's@^URIs: http://security.ubuntu.com/ubuntu/@URIs: http://mirrors.huaweicloud.com/ubuntu/@g' /etc/apt/sources.list.d/ubuntu.sources
sed -i 's@^Types: deb@Types: deb-src deb@g' /etc/apt/sources.list.d/ubuntu.sources

apt update
apt --no-install-recommends -y install apt-utils
apt --no-install-recommends -y install whiptail
apt --no-install-recommends --auto-remove --purge -y full-upgrade
apt --no-install-recommends -y install language-pack-zh-hans systemd-sysv kmod
export LANG=zh_CN.utf8 LANGUAGE=zh_CN.utf8
echo "export LANG=zh_CN.utf8 LANGUAGE=zh_CN.utf8" >> "$HOME/.profile"
cat > /etc/wsl.conf << EOF
[boot]
systemd=true
initTimeout=60000

[interop]
enabled = false
appendWindowsPath = false
EOF
exit

wsl --shutdown
wsl -d Ubuntu-24.10 -u root --cd /root -e /bin/login -p -f root


# 其它：
wsl -l --all -v
wsl --shutdown
wsl --unregister Ubuntu-23.10
wsl -d Ubuntu-23.10 hostname -I
wsl --system

# 配置文件 C:\Users\xxx\.wslconfig
[wsl2]
# 内存回收
#pageReporting=false
processors=12
swap=0
memory=8GB
guiApplications=true
#kernel=F:\\wsl\\files\\bzImage
kernelCommandLine=nospec_store_bypass_disable spec_store_bypass_disable=off nospectre_v1 nospectre_v2 spectre_v2=off mitigations=off spectre_v2_user=off mds=off nopti l1tf=off audit=0 ima=off evm=fix selinux=0
#debugConsole=true
#safeMode=true

networkingMode=NAT
firewall=false
autoProxy=true
#defaultVhdSize=1099511627776

[experimental]
# 内存回收
#autoMemoryReclaim=false
sparseVhd=true



# 清理磁盘空间
1. wsl --shutdown
2. wsl --manage Ubuntu-24.10 --set-sparse true
3. 以安全模式启动
4. apt --no-install-recommends -y install zerofree
5. mount -o remount,ro /dev/sdb
6. zerofree -v -f 0 /dev/sdb
